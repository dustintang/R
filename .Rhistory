office[,4]<-str_sub(office[,4],end = -8)
summary(office[,3])
office<-office[,-3]
colnames(AO)<-c("name","price","fys","qt","rq","kz","qy","db","dz","dt","dtz","jl")
colnames(AO)<-c("name","price","fys","qt","rq","kz","qy","db","dz","dt","dtz","jl")
colnames(office)<-c("name","price","fys","qt","rq","kz","qy","db","dz","dt","dtz","jl")
View(office)
View(office)
avg(office$price)
mean(office$price)
mean(office)
mean(office$price)
ao1<-str_split_fixed( ao,"位", n=2 )
library(xml2)
library(rvest)
library(stringr)
library(ggplot2)
ao<-office[,"rq"]
ao1<-str_split_fixed( ao,"位", n=2 )
ao2<-str_split_fixed( ao1[,2],",",n=2)
View(ao2)
View(ao1)
ao11<-str_sub(ao1[,1],4,6)
ao11<-str_sub(ao1[,1],6,8)
ao3<-str_replace_all(ao2[,1]," ","")
ao11<-str_sub(ao1[,1],3,6)
ao11<-str_sub(ao1[,1],7,10)
ao11<-str_replace_all(ao2[,1]," ","")
ao11<-str_sub(ao1[,1],7,10)
ao11<-str_sub(ao1[,1],4,7)
ao11<-str_replace_all(ao2[,1]," ","")
ao11<-str_sub(ao11,4,7)
ao1<-str_split_fixed( ao,"位", n=2 )
ao2<-str_split_fixed( ao1[,2],",",n=2)
ao11<-str_sub(ao1[,1],4,7)
ao11<-str_sub(ao1[,1],3,6)
ao11<-str_sub(ao1[,1],1,6)
ao11<-str_replace_all(ao1[,1]," ","")
ao11<-str_sub(ao11,1,6)
ao11<-str_sub(ao11,4,6)
ao11<-str_replace_all(ao1[,1]," ","")
ao11<-str_sub(ao11,4,6)
ao11<-str_sub(ao11,5,8)
ao11<-str_replace_all(ao1[,1]," ","")
ao11<-str_sub(ao11,5,8)
View(ao2)
ao3<-str_split_fixed( ao2[,2],"次",n=2)
View(ao3)
AO<-cbind(ao11,ao3[,1])
View(AO)
View(AO)
office<-cbind(office[,-5],AO)  ##新产生地铁数据细分完成
ao<-office[,"kz"]
ao1<-str_split_fixed( ao,"-", n=2 )
View(ao1)
ao11<-str_sub(ao1,5,8)
ao11<-str_replace_all(ao1[,1]," ","")
ao11<-str_sub(ao11,5,8)
ao11<-str_replace_all(ao1[,1]," ","")
ao11<-str_sub(ao11,7,10)
ao1<-str_split_fixed( ao,"-", n=2 )
ao2<-str_split_fixed( ao1[,1],"m", n=2 )
ao21<-str_replace_all(ao2[,1]," ","")
ao21<-str_sub(ao21,7,10)
ao21<-str_replace_all(ao2[,1]," ","")
ao21<-str_sub(ao21,7,11)
View(ao2)
ao3<-str_split_fixed( ao1[,2],"m", n=2 )
View(ao3)
AO<-cbind(ao21,ao3[,1])  #可租房面积段最低、最高平数
View(AO)
office<-cbind(office[,-5],AO)  ##可租面积段细分完成
colnames(office)
colnames(office[11])
colnames(office[10])
colnames(office[,10])
colnames(office[,11])
colnames(office[,7])
colnames(office[1])
colnames(office[,1:3])
colnames(office[,11:14])
colnames(office[,11:14])<-c("gz","yy","min","max")
colnames(office)
View(office)
View(office)
View(temp1)
library(RMySQL)
library(DBI)
library(RMySQL)
conn <- dbConnect(MySQL(), dbname = "Innovation", username="root", password="123456",
host="127.0.0.1",port=3306)
dbListTables(conn)
dbSendQuery(conn,"SET NAMES utf8")
conn <- dbConnect(MySQL(), dbname = "bg", username="root", password="123456",
host="127.0.0.1",port=3306)
dbSendQuery(conn,"SET NAMES utf8")
conn <- dbConnect(MySQL(), dbname = "bg", username="root", password="123456",
host="127.0.0.1",port=3306)
dbSendQuery(conn,"SET NAMES utf8")
dbWriteTable(conn,"office",dataframe,overwrite=TRUE)
dbWriteTable(conn,"office",overwrite=TRUE)
dbWriteTable(conn,"office",matrix,overwrite=TRUE)
?dbWriteTable
office_df<-as.data.frame(office)
View(office_df)
colnames(office)<-c("name","price","fys","qt","qy","db","dz","dt","dtz","jl","gz","yy","min","max") #重命名各列
View(office)
office_df<-as.data.frame(office)
View(office_df)
dbWriteTable(conn,"office_df",office_df[,1:14],overwrite=TRUE)
DateCor <- cor(office[-1,-1])
View(office)
?cor
Cl <- cor(longley)
c1
C1
CL
Cl
View(office)
DateCor <- cor(office[,c("price","fys")])
office[,c("price","fys")
]
class(longley)
DateCor <- cor(office_df[,c("price","fys")])
class(office_df[,c("price","fys")])
str(office_df[,c("price","fys")])
DateCor <- cor(as.integer(office_df[,c("price","fys")]))
DateCor <- cor(as.numeric(office_df[,c("price","fys")]))
DateCor <- cor(as.numeric(as.character(office_df[,c("price","fys")])))
as.numeric(office_df$price)
class(office)
class(office$price)
class(office[,"price"])
sapply(office_df[,c("price","fys")],as.numeric)
class(office_df$fys)
class(office_df$price)
sapply(office_df[,c("price","fys")],as.character)
class(office_df$price)
office_df[,c("price","fys")]
class(as.numeric(office_df$price))
class(sapply(office_df[,c("price","fys")],as.character))
typeof(sapply(office_df[,c("price","fys")],as.character))
typeof(sapply(office_df[,c("price","fys")],as.numeric))
typeof(sapply(office_df[,c("price","fys","jl","gz","yy","min","max")],as.numeric))
class(sapply(office_df[,c("price","fys","jl","gz","yy","min","max")],as.numeric))
odf<-data.frame(sapply(office_df[,c("price","fys","jl","gz","yy","min","max")],as.numeric))
View(odf)
typeof(odf)
odf<-as.data.frame(sapply(office_df[,c("price","fys","jl","gz","yy","min","max")],as.numeric))
typeof(odf)
class(odf)
odf<-data.frame(sapply(office_df[,c("price","fys","jl","gz","yy","min","max")],as.numeric))
class(odf)
odf<-cbind(odf,office_df[,"name"])
View(odf)
odf<-cbind(odf,office_df[,c("name","qy")])
View(odf)
odf<-data.frame(sapply(office_df[,c("price","fys","jl","gz","yy","min","max")],as.numeric))
odf<-cbind(odf,office_df[,c("name","qy","db","dz","dt","dtz")])
View(odf)
DateCor <- cor(odf[,c("price","fys")])
View(DateCor)
DateCor <- cor(odf[,1:7])
View(DateCor)
install.packages("openxlsx", lib="/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
install.packages("openxlsx")
install.packages("VIM")
ls()
ls(1:3)
?gc
rm("AO")
rm(c("AO","ao1","ao2","ao3","o1","temp1","a","ao","ao11","ao12","ao21","b","dz","hw","i","kz","o","o2","office2","rq","url","temp2")
odf<-data.frame(sapply(office_df[,c("price","fys","jl","gz","yy","min","max")],as.numeric))
odf<-cbind(odf,office_df[,c("name","qy","db","dz","dt","dtz")])
DateCor <- cor(odf[,1:7])  ##数据相关性
View(odf)
rm(c("AO","ao1","ao2","ao3","o1","temp1","a","ao","ao11","ao12","ao21","b","dz","hw","i","kz","o","o2","office2","rq","url","temp2"))
gc(rm(ls()))
rm(ls())
gc(rm(list=ls()))
conn <- dbConnect(MySQL(), dbname = "bg", username="root", password="123456",host="127.0.0.1",port=3306)
dbReadTable(conn, "office_df")
dbSendQuery(conn,"SET NAMES utf8")
dbReadTable(conn, "office_df")
office_df<-dbReadTable(conn, "office_df")
View(office_df)
typeof(officedf_price)
typeof(office_df$price)
odf<-data.frame(sapply(office_df[,c("price","fys","jl","gz","yy","min","max")],as.numeric))
odf<-cbind(odf,office_df[,c("name","qy","db","dz","dt","dtz")])
View(odf)
View(office_df)
is.na(office_df$max)
which(office_df==NA)
which(office_df=="NA")
which(office_df$max=="NA")
which(office_df$max==NA)
library(VIM)
aggr(df2, prop = FALSE, numbers = TRUE)
aggr(office_df, prop = FALSE, numbers = TRUE)
aggr(office_df$max, prop = FALSE, numbers = TRUE)
is.na.data.frame(office_df)
is.na.data.frame(office_df$yy)
is.na(office_df$yy)
office_df$yy[13]
is.null(office_df$yy)
class(office_df$yy[13])
class(office_df$yy[14])
class(office_df$yy)
class(office_df$price)
class(odf$price)
is.null(odf$yy)
is.na(odf$yy)
View(odf)
which(is.na(odf$yy)==T)
library(VIM)
library(VIM)
aggr(odf)
miss<-aggr(odf)
odf[which(is.na(odf$yy)==T),"yy"]<-0
aggr(odf)
odf[which(is.na(odf$gz)==T),"gz"]<-0
aggr(odf)
x<-which(is.na(odf$gz)==T)
x<-which(is.na(odf$max)==T)
x
odf[x,max]<-odf[x,min]
vector(x)
as.vector(x)
x<-as.vector(which(is.na(odf$max)==T))
odf[x,max]<-odf[x,min]
class(x)
typeof(x)
str(x)
summary(x)
a<-c(1,2,3)
odf[a,"gz"]
odf[a,"max"]
odf[x,max]
x<-as.numeric(which(is.na(odf$max)==T))
odf[x,max]<-odf[x,min]
odf[x,"max"]<-odf[x,"min"]
rm(a)
aggr(odf)
x<-which(is.na(odf$max)==T)
odf[x,"max"]<-odf[x,"min"]
aggr(odf)
odf<-data.frame(sapply(office_df[,c("price","fys","jl","gz","yy","min","max")],as.numeric))
odf<-cbind(odf,office_df[,c("name","qy","db","dz","dt","dtz")])
miss<-aggr(odf)  #处理缺失值
odf[which(is.na(odf$yy)==T),"yy"]<-0
odf[which(is.na(odf$gz)==T),"gz"]<-0
x<-which(is.na(odf$max)==T)
odf[x,"max"]<-odf[x,"min"]
aggr(odf)
a<-na
a<-""
is.na(a)
DateCor <- cor(odf[,1:7])  ##数据相关性
View(DateCor)
DateCor <- cor(odf[,1:7],use = all.obs )  ##数据相关性
?cor
DateCor <- cor(odf[,1:7],use =  "everything")  ##数据相关性
View(DateCor)
DateCor <- cor(odf[,1:7],na.rm)  ##数据相关性
DateCor <- cor(odf[,1:7],na.rm=T)  ##数据相关性
DateCor <- cor(odf[,1:7], use="all.obs")  ##数据相关性
View(DateCor)
DateCor <- cor(odf[,1:7], use="complete")  ##数据相关性
View(DateCor)
rm(a)
library(ggplot2)
qplot
?qplot
qplot(jl,price,data=odf)
qplot(jl,price,data=odf,alpha(1/2))
qplot(jl,price,data=odf,alpha=1/2)
qplot(jl,price,data=odf,alpha=1/5)
qplot(jl,price,data=odf,alpha=1/20)
qplot(jl,price,data=odf,alpha=1/100)
qplot(jl,price,data=odf,alpha=1/1000)
qplot(jl,price,data=odf,alpha=1/10)
prjl<-qplot(jl,price,data=odf,alpha=1/10)
cor.test(odf[,1:7])
install.packages("psych", lib="/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
library(psych)
odf<-data.frame(sapply(office_df[,c("price","fys","jl","gz","yy","min","max")],as.numeric))
odf<-cbind(odf,office_df[,c("name","qy","db","dz","dt","dtz")])
miss<-aggr(odf)  #处理缺失值
odf[which(is.na(odf$yy)==T),"yy"]<-0
odf[which(is.na(odf$gz)==T),"gz"]<-0
x<-which(is.na(odf$max)==T)
odf[x,"max"]<-odf[x,"min"]
DateCor <- cor(odf[,1:7], use="complete")  ##数据相关性，得出价格和距离、关注和预约相关性高
library(psych)
corr.test(odf[,1:7])
DateCor <- corr.test(odf[,1:7])
prjl
DateCor <- corr.test(odf[,1:7]) ##数据相关性，得出价格和距离、关注和预约相关性高
library(psych)
DateCor <- corr.test(odf[,1:7]) ##数据相关性，得出价格和距离、关注和预约相关性高
dateCor <- corr.test(odf[,1:7]) ##数据相关性，得出价格和距离、关注和预约相关性高
rm(DateCor)
datecor <- corr.test(odf[,1:7]) ##数据相关性，得出价格和距离、关注和预约相关性高
rm(dateCor)
datecor
datesum<-summary(odf)
datesum
typeof(odf$dt)
rm(odf)
odf1<-data.frame(sapply(office_df[,c("price","fys","jl","gz","yy","min","max")],as.numeric))
odf2<-data.frame(sapply(office_df[,c("qy","db","dt","dtz")],as.factor))
odf<-cbind(odf1,odf2,office_df[,c("name""dz")])
odf<-cbind(odf1,odf2,office_df[,c("name","dz")])
View(odf)
miss<-aggr(odf)  #处理缺失值
library(VIM)
library(VIM)
miss<-aggr(odf)  #处理缺失值
odf[which(is.na(odf$yy)==T),"yy"]<-0
odf[which(is.na(odf$gz)==T),"gz"]<-0
x<-which(is.na(odf$max)==T)
odf[x,"max"]<-odf[x,"min"]  #缺失值处理完
aggr(odf)
datesum<-summary(odf)
datesum
datecor <- corr.test(odf[,1:7]) ##数据相关性，得出价格和距离、关注和预约相关性高
datecor
prjl<-qplot(jl,price,data=odf,alpha=1/10)
library(ggplot2)
prjl<-qplot(jl,price,data=odf,alpha=1/10)
prjl
avg_price <- aggregate(odf$price, by = list(odf$qy), mean)
avg_price
p <- ggplot(data = avg_price, mapping = aes(x = reorder(Group.1, -x), y = x, group = 1)) +
geom_area(fill = 'lightgreen') +
geom_line(colour = 'steelblue', size = 2) +
geom_point() +
xlab('') +
ylab('均价')
p
p <- ggplot(data = avg_price, mapping = aes(x = reorder(Group.1, -x), y = x, group = 1)) +
geom_area(fill = 'lightgreen') +
geom_line(colour = 'steelblue', size = 2) +
geom_point() +
xlab('') +
ylab('均价') +
theme(text=element_text(family="Hei"))
p
p1 <- ggplot(data = avg_price, mapping = aes(x = reorder(Group.1, -x), y = x, group = 1)) +
geom_area(fill = 'lightgreen') +
geom_line(colour = 'steelblue', size = 2) +
geom_point() +
xlab('') +
ylab('均价') +
theme(text=element_text(family="Hei"))
avg_price <- aggregate(odf$price, by = list(odf$dt), mean)
p1 <- ggplot(data = avg_price, mapping = aes(x = reorder(Group.1, -x), y = x, group = 1)) +
geom_area(fill = 'lightgreen') +
geom_line(colour = 'steelblue', size = 2) +
geom_point() +
xlab('') +
ylab('均价') +
theme(text=element_text(family="Hei"))
avg_price <- aggregate(odf$price, by = list(odf$qy), mean)
p1 <- ggplot(data = avg_price, mapping = aes(x = reorder(Group.1, -x), y = x, group = 1)) +
geom_area(fill = 'lightgreen') +
geom_line(colour = 'steelblue', size = 2) +
geom_point() +
xlab('') +
ylab('均价') +
theme(text=element_text(family="Hei"))
avg_price <- aggregate(odf$price, by = list(odf$db), mean)
p2 <- ggplot(data = avg_price, mapping = aes(x = reorder(Group.1, -x), y = x, group = 1)) +
geom_area(fill = 'lightgreen') +
geom_line(colour = 'steelblue', size = 2) +
geom_point() +
xlab('') +
ylab('均价') +
theme(text=element_text(family="Hei"))
avg_price <- aggregate(odf$price, by = list(odf$dt), mean)
p3 <- ggplot(data = avg_price, mapping = aes(x = reorder(Group.1, -x), y = x, group = 1)) +
geom_area(fill = 'lightgreen') +
geom_line(colour = 'steelblue', size = 2) +
geom_point() +
xlab('') +
ylab('均价') +
theme(text=element_text(family="Hei"))
avg_price <- aggregate(odf$price, by = list(odf$dtz), mean)
p4 <- ggplot(data = avg_price, mapping = aes(x = reorder(Group.1, -x), y = x, group = 1)) +
geom_area(fill = 'lightgreen') +
geom_line(colour = 'steelblue', size = 2) +
geom_point() +
xlab('') +
ylab('均价') +
theme(text=element_text(family="Hei"))
p2
p3
p4
tot.wssplot <- function(data, nc, seed=1234){
#假设分为一组时的总的离差平方和
tot.wss <- (nrow(data)-1)*sum(apply(data,2,var))
for (i in 2:nc){
#必须指定随机种子数
set.seed(seed)
tot.wss[i] <- kmeans(data, centers=i, iter.max = 100)$tot.withinss
}
plot(1:nc, tot.wss, type="b", xlab="Number of Clusters",
ylab="Within groups sum of squares",col = 'blue',
lwd = 2, main = 'Choose best Clusters')
}
View(odf)
View(odf)
standrad <- data.frame(scale(odf[,c('price','min','max')]))
myplot <- tot.wssplot(standrad, nc = 15)
kmeans
myplot <- tot.wssplot(standrad, nc = 15)
standrad <- data.frame(scale(odf[,c('price')]))
myplot <- tot.wssplot(standrad, nc = 15)
set.seed(1234)
clust <- kmeans(x = standrad, centers = 5, iter.max = 100)
table(clust$cluster)
table(odf$qy,clust$cluster)
aggregate(odf$price, list(odf$qy), mean)
aggregate(odf$price, list(odf$qy.new), mean)
aggregate(odf$price, list(clust$cluster), mean)
aggregate(odf$jl, list(clust$cluster), mean)
aggregate(odf$dt, list(clust$cluster), mean)
aggregate(odf$fys, list(clust$cluster), mean)
clust <- kmeans(x = standrad, centers = 4, iter.max = 100)
table(clust$cluster)
table(odf$qy,clust$cluster)
aggregate(odf$fys, list(clust$cluster), mean)
aggregate(odf$price, list(clust$cluster), mean)
aggregate(odf$jl, list(clust$cluster), mean)
aggregate(odf$max, list(clust$cluster), mean)
p <- ggplot(data = odf, mapping = aes(x = jl,y = price, color = factor(clust$cluster)))
p <- p + geom_point(pch = 20, size = 3)
p + scale_colour_manual(values = c("red","blue", "green", "black", "orange"))
p <- ggplot(data = odf, mapping = aes(x = fys,y = price, color = factor(clust$cluster)))
p <- p + geom_point(pch = 20, size = 3)
p + scale_colour_manual(values = c("red","blue", "green", "black", "orange"))
p <- ggplot(data = odf, mapping = aes(x = gz,y = price, color = factor(clust$cluster)))
p <- p + geom_point(pch = 20, size = 3)
p + scale_colour_manual(values = c("red","blue", "green", "black", "orange"))
p <- ggplot(data = odf, mapping = aes(x = jl,y = price, color = factor(clust$cluster)))
p <- p + geom_point(pch = 20, size = 3)
p + scale_colour_manual(values = c("red","blue", "green", "black", "orange"))
datesum<-summary(odf)  #综述
datasum
datesum
datecov
datecor
prjl
p2
p1
p2
library("plyr")
library("dplyr")
library("ggplot2")
library("ggmap")
library("maptools")
library("maps")
library("Cairo")
library("baidumap")
install.packages("baidumap", lib="/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
install.packages("baidumap")
library(baidumap)
install.packages("baidumap", lib="/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
library(devtools)install_github('badbye/baidumap')library(baidumap)
library(devtools)
install_github('badbye/baidumap')library(baidumap)
install_github('badbye/baidumap')
library(baidumap)
lon = matrix(c(117.93780, 24.55730, 117.93291, 24.57745, 117.23530, 24.64210, 117.05890, 24.74860), byrow=T, ncol=2)### json location_json = getLocation(lon[, 1], lon[, 2], output='json')### xmllocation_xml = getLocation(lon[, 1], lon[, 2], output='xml')## formattedlocation = getLocation(lon[, 1], lon[, 2], formatted = T)
lon
getCoordinate('北京大学')
getBaiduMap(lon=116.354431, lat=39.942333)library(ggmap)ggmap(p)
p <- getBaiduMap(lon=116.354431, lat=39.942333)library(ggmap)ggmap(p)
getBaiduMap(lon=116.354431, lat=39.942333)
ql<-getPlace(place='青年旅舍', city='上海')
head(ql)
dim(ql)     # 共搜索出172家青旅
x<-ql$lon; y<-ql$lat    # 获取青旅的横纵坐标
library(maptools)    # 加载 maptools 包
install.packages(c("Map", "tools"), lib="/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
install.packages(c("Map", "tools"), lib = "/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
install.packages(c("Map", "tools"), lib = "/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
install.packages(c("Map", "tools"), lib = "/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
library(maptools)    # 加载 maptools 包
install.packages("maptools", lib="/Library/Frameworks/R.framework/Versions/3.3/Resources/library")
library(maptools)    # 加载 maptools 包
install.packages(sp)
library(sp)
shape<-readShapePoly('~/县级行政界线/BOUNT_poly.shp')
center<-getCoordinate('上海', formatted=T)
library(maptools)    # 加载 maptools 包
shape<-readShapePoly('~/县级行政界线/BOUNT_poly.shp')
center<-getCoordinate('上海', formatted=T)
library("plyr")
library("dplyr")
library("ggplot2")
library("ggmap")
library("maptools")
library("maps")
library("Cairo")
library("baidumap")
bbox_everest <- c(left =60, bottom =10, right =150, top =60)
mapdata<-get_stamenmap(bbox_everest, zoom =5)
mapdata
install.packages('rattle')
library(rattle)
